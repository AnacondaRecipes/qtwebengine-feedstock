From 4ab3572626c8e2be7244ea2c9f53c6051dcf5c42 Mon Sep 17 00:00:00 2001
From: "Rafael G. Martins" <rafael@rafaelmartins.eng.br>
Date: Sun, 14 Jul 2024 23:33:09 +0200
Subject: [PATCH 1/3] chromium: angle: disable vulkan for linux

---
 src/3rdparty/chromium/chrome/BUILD.gn                 | 4 ++--
 src/3rdparty/chromium/third_party/angle/BUILD.gn      | 2 +-
 src/3rdparty/chromium/third_party/angle/gni/angle.gni | 2 +-
 src/3rdparty/chromium/ui/gl/BUILD.gn                  | 6 +++---
 4 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/src/3rdparty/chromium/chrome/BUILD.gn b/src/3rdparty/chromium/chrome/BUILD.gn
index a3124bc32..5448999bb 100644
--- a/src/3rdparty/chromium/chrome/BUILD.gn
+++ b/src/3rdparty/chromium/chrome/BUILD.gn
@@ -1767,7 +1767,7 @@ if (is_linux || is_chromeos) {
       if (is_linux) {
         deps += [ ":swiftshader_vk_symbols" ]
       }
-      if (!is_chromeos) {
+      if (!(is_chromeos || is_linux)) {
         deps += [ ":angle_libvulkan_symbols" ]
       }
       if (build_with_internal_optimization_guide) {
@@ -1834,7 +1834,7 @@ if (is_linux || is_chromeos) {
 
       deps = [ "//third_party/angle:libGLESv2" ]
     }
-    if (!is_chromeos) {
+    if (!(is_chromeos || is_linux)) {
       extract_symbols("angle_libvulkan_symbols") {
         binary = "$root_out_dir/libvulkan.so.1"
 
diff --git a/src/3rdparty/chromium/third_party/angle/BUILD.gn b/src/3rdparty/chromium/third_party/angle/BUILD.gn
index f85669f53..c23b83728 100644
--- a/src/3rdparty/chromium/third_party/angle/BUILD.gn
+++ b/src/3rdparty/chromium/third_party/angle/BUILD.gn
@@ -609,7 +609,7 @@ angle_static_library("angle_gpu_info_util") {
   libs = []
   defines = []
 
-  if (angle_build_vulkan_system_info) {
+  if (angle_build_vulkan_system_info && !is_linux) {
     sources += libangle_gpu_info_util_vulkan_sources
     deps += [
       "$angle_vulkan_headers_dir:vulkan_headers",
diff --git a/src/3rdparty/chromium/third_party/angle/gni/angle.gni b/src/3rdparty/chromium/third_party/angle/gni/angle.gni
index 27327b1ec..3416b2169 100644
--- a/src/3rdparty/chromium/third_party/angle/gni/angle.gni
+++ b/src/3rdparty/chromium/third_party/angle/gni/angle.gni
@@ -178,7 +178,7 @@ declare_args() {
       angle_has_build &&
       !(is_android && build_with_chromium && is_official_build) &&
       ((is_win && !angle_is_winuwp) ||
-       ((is_linux || is_chromeos) &&
+       ((is_chromeos) &&
         (angle_use_x11 || angle_use_wayland || angle_use_vulkan_display)) ||
        is_android || is_fuchsia || is_ggp || is_mac)
 
diff --git a/src/3rdparty/chromium/ui/gl/BUILD.gn b/src/3rdparty/chromium/ui/gl/BUILD.gn
index 733f2169f..6a1922e42 100644
--- a/src/3rdparty/chromium/ui/gl/BUILD.gn
+++ b/src/3rdparty/chromium/ui/gl/BUILD.gn
@@ -261,7 +261,7 @@ jumbo_component("gl") {
         "//third_party/angle:libEGL",
         "//third_party/angle:libGLESv2",
       ]
-      if (angle_shared_libvulkan && !is_chromeos) {
+      if (angle_shared_libvulkan && !(is_chromeos || is_linux)) {
         data_deps += [ "//third_party/vulkan-deps/vulkan-loader/src:libvulkan" ]
       }
     }
@@ -289,7 +289,7 @@ jumbo_component("gl") {
       "//third_party/angle:libEGL",
       "//third_party/angle:libGLESv2",
     ]
-    if (angle_shared_libvulkan && !is_chromeos) {
+    if (angle_shared_libvulkan && !(is_chromeos || is_linux)) {
       data_deps += [ "//third_party/vulkan-deps/vulkan-loader/src:libvulkan" ]
     }
   }
@@ -383,7 +383,7 @@ jumbo_component("gl") {
         "//third_party/swiftshader/src/Vulkan:swiftshader_libvulkan",
       ]
     }
-    if (angle_shared_libvulkan && !is_chromeos) {
+    if (angle_shared_libvulkan && !(is_chromeos || is_linux)) {
       data_deps += [ "//third_party/vulkan-deps/vulkan-loader/src:libvulkan" ]
     }
   }
-- 
2.43.0

