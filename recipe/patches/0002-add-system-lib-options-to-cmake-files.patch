From 666bfe8f6ae96d1a9ab21917efaad3de6e8b5061 Mon Sep 17 00:00:00 2001
From: Brian Wing <bwing@anaconda.com>
Date: Tue, 27 Jan 2026 03:32:35 -0800
Subject: [PATCH] Add system lib options to CMake files

---
 src/core/CMakeLists.txt | 41 ++++++++++++++++++++++++++++++++++++-----
 src/pdf/CMakeLists.txt  | 11 +++++++++++
 2 files changed, 47 insertions(+), 5 deletions(-)

diff --git a/src/core/CMakeLists.txt b/src/core/CMakeLists.txt
index 64ef09f2e4..1b1f7349f7 100644
--- a/src/core/CMakeLists.txt
+++ b/src/core/CMakeLists.txt
@@ -417,10 +417,6 @@ foreach(arch ${archs})
             ARGS enable_webrtc
             CONDITION QT_FEATURE_webengine_webrtc
         )
-        extend_gn_list(gnArgArg
-            ARGS enable_screen_capture
-            CONDITION QT_FEATURE_webengine_webrtc
-        )
         extend_gn_list(gnArgArg
             ARGS enable_hangout_services_extension
             CONDITION QT_FEATURE_webengine_webrtc AND QT_FEATURE_webengine_extensions
@@ -479,7 +475,7 @@ foreach(arch ${archs})
                 ozone_extra_path="${CMAKE_CURRENT_LIST_DIR}/ozone/ozone_extra.gni"
             )
             set(systemLibs libjpeg libpng freetype harfbuzz libwebp libxml
-                opus snappy icu ffmpeg re2 lcms2 libopenjpeg2 libvpx
+                opus snappy icu ffmpeg re2 lcms2 libopenjpeg2 libxslt libvpx
             )
             foreach(slib ${systemLibs})
                 extend_gn_list(gnArgArg
@@ -598,12 +594,47 @@ foreach(arch ${archs})
                 endif()
             endif()
             unset(cpu)
+        else()
+            set(systemLibs libjpeg libpng freetype harfbuzz libevent libwebp libxml opus snappy icu ffmpeg re2
+                libopenjpeg2 libxslt libvpx)
+            foreach(slib ${systemLibs})
+                extend_gn_list(gnArgArg
+                    ARGS use_system_${slib}
+                    CONDITION QT_FEATURE_webengine_system_${slib}
+                )
+            endforeach()
+            extend_gn_list(gnArgArg
+                    ARGS use_system_zlib use_system_minizip
+                    CONDITION QT_FEATURE_webengine_system_zlib AND QT_FEATURE_webengine_system_minizip
+            )
+            extend_gn_list(gnArgArg
+                ARGS pdfium_use_system_libpng
+                CONDITION QT_FEATURE_webengine_system_libpng
+            )
+            extend_gn_list(gnArgArg
+                ARGS pdfium_use_system_libtiff
+                CONDITION QT_FEATURE_webengine_system_libtiff
+            )
+            extend_gn_list(gnArgArg
+                ARGS pdfium_use_system_zlib
+                CONDITION QT_FEATURE_webengine_system_zlib
+            )
+            extend_gn_list(gnArgArg
+                ARGS rtc_build_ssl libsrtp_build_boringssl
+                CONDITION NOT QT_FEATURE_webengine_system_ssl
+            )
         endif()
 
         if(MACOS)
             list(APPEND gnArgArg
                 use_external_popup_menu=false
                 skia_use_metal=false
+                enable_screen_capture=true
+            )
+        else()
+            extend_gn_list(gnArgArg
+                ARGS enable_screen_capture
+                CONDITION QT_FEATURE_webengine_webrtc
             )
         endif()
 
diff --git a/src/pdf/CMakeLists.txt b/src/pdf/CMakeLists.txt
index a318051eae..e1db4f6193 100644
--- a/src/pdf/CMakeLists.txt
+++ b/src/pdf/CMakeLists.txt
@@ -243,6 +243,17 @@ foreach(arch ${archs})
             ARGS use_qt_freetype
             CONDITION QT_FEATURE_webengine_qt_freetype
         )
+        set(systemLibs libjpeg harfbuzz freetype)
+        foreach(slib ${systemLibs})
+            extend_gn_list(gnArgArg
+                ARGS use_system_${slib}
+                CONDITION QT_FEATURE_webengine_system_${slib}
+            )
+        endforeach()
+        extend_gn_list(gnArgArg
+            ARGS pdf_bundle_freetype
+            CONDITION NOT QT_FEATURE_webengine_system_freetype
+        )
 
         add_gn_command(
             CMAKE_TARGET Pdf
-- 
2.39.3 (Apple Git-146)

